<!DOCTYPE html>
<html lang="en">
	<head>
  		<title>Animal Crossing Birthdays</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width initial-scale=1.0" />
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
        <link href='https://fonts.googleapis.com/css?family=Dekko' rel='stylesheet'>
        <script src="js/jquery-3.4.1.min.js"></script>
        <script src="js/moment.js"></script>
        <meta name="description" content="Study Animal Crossing Birthdays">
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-142108931-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-142108931-1');
        </script>
    </head>
    <body style="font-family: 'Dekko';">
        <header>
            <h1 class="h1">
                Unofficial Animal Crossing birthday study guide!
            </h1>
        </header>
    	<main>
    	
            <section>
                <h2 id="name" class="h2"></h2>
                <img id="image" onclick="next()" class="animalImage" />
                <h3 id="birthday" class="h3"></h3>
                <button onclick="next()" class="nextButton">Next</button>
                <div>
                    <div class="searchDiv"> 
                        <input id="search" placeholder="Search" class="searchInput" />
                        <button onclick="search()" class="searchButton"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
            </section>

            <script type="text/javascript">
                var state = {
                    characters: [],
                    curIndex: 0
                }

                $.getJSON("birthdays.json", function(json) {
                    $.each(json, function () {
                        var obj = this;
                        var imageUrl = "img/"+obj["name"]+".png";
                        var birthday = moment(obj["birthday"], "DD-MM-YYYY").format("MMM Do YYYY");
                        var char = {  
                            name: obj["name"],
                            birthday: birthday,
                            image: imageUrl
                        };
                        state.characters.push(char);
                    });

                    state.characters = shuffle(state.characters);
                    state.curIndex = 0;
                    load(state.characters[state.curIndex]);
                });
                
                function next() {
                    loadNextItem(state);
                }

                function loadNextItem(state) {
                    if (state.curIndex == state.characters.length - 1) {
                        state.curIndex = 0;
                        load(state.characters[state.curIndex]);
                    }
                    else {
                        load(state.characters[++state.curIndex]);
                    }
                }

                var searchState = {
                    searchFor: null,
                    characters: [],
                    curIndex: 0
                }

                function search() {
                    var searchFor = $("#search").val().trim();
                    if (searchFor.length == 0)
                        return;
                    if (searchFor === searchState.searchFor) {
                        loadNextItem(searchState);
                    } else {
                        searchState.searchFor = searchFor;
                        var re = new RegExp(searchFor+'.+$', 'i');
                        searchState.characters = state.characters.filter(function(e, i, a) {
                            return e["name"].search(re) != -1;
                        });
                        if (searchState.characters.length > 0) {
                            searchState.curIndex = 0;                          
                            load(searchState.characters[searchState.curIndex]);
                        }
                    }
                }

                document.getElementById('search').onkeypress = function(e){
                    if (!e) e = window.event;
                    var keyCode = e.keyCode || e.which;
                    if (keyCode == '13'){
                        search()
                    }
                }
                
                /**
                 * Shuffles array in place.
                 * @param {Array} a items An array containing the items.
                 * https://stackoverflow.com/a/6274381/4102299
                 */
                function shuffle(a) {
                    var j, x, i;
                    for (i = a.length - 1; i > 0; i--) {
                        j = Math.floor(Math.random() * (i + 1));
                        x = a[i];
                        a[i] = a[j];
                        a[j] = x;
                    }
                    return a;
                }
 
                function load(obj) {
                    $("#name").text(obj["name"]);
                    $("#image").attr("src", obj["image"]);
                    $("#birthday").text(obj["birthday"]);
                }

            </script>
    	</main>
        <footer>
            <p class="footer"><a href="https://www.copyright.gov/fair-use/">FAIR USE</a>. For Education Purposes Only. Â© 2001 - 2020 Nintendo. Nintendo properties are trademarks of Nintendo. Images and data from <a href="https://animal-crossing.com">http://animal-crossing.com</a>.</p>
        </footer>
    </body>
</html>